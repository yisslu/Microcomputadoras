#include <16f887.h>
#include<stdlib.h>
#include<stdio.h>

#fuses HS, NOWDT, NOPROTECT, NOLVP

#use delay(clock=20MHz)
#use rs232(baud=9600, xmit=PIN_C6, rcv=PIN_C7)
#use i2c(MASTER, SDA=PIN_C4, SCL=PIN_C3,SLOW, NOFORCE_SW)
#include <lcd.c>
//#include "i2c-lcd.c"

/* Prototipo de funciones */
void escribir_i2c();
void obtenerTemperatura();

int8 contador=0; //contador principal
int8 countAux = 0; //contador auxiliar
char getch(void);
float valor_temperatura = 0.0;

void obtenerTemperatura() {
    printf("Leyendo temperatura...\n\r");
    set_adc_channel(0);
    delay_ms(10);
    valor_temperatura = read_adc()*2;
}

void escribir_i2c(){
//!   printf("Escribir I2C\n");
//!   i2c_start();
//!   i2c_write(0x42); //Direcion del esclavo
//!   i2c_write(contador); //El dato a escribir
//!   i2c_stop();
}

/* Enviar al correo: moises.melendes@fi-b.unam.mx*/
/* Asunto: Diagrama Proteus Grupo 4*/
void main()
{
    // Se configuran las interrupciones, el display LCD y el puerto A
    lcd_init();
    //enable_interrupts(INT_RB);
    enable_interrupts(GLOBAL);
    Setup_port_a(ALL_ANALOG);
    Setup_adc(ADC_CLOCK_INTERNAL);
    while (TRUE) {
        printf("Prueba: %d\n\r"); // DEBUG
        obtenerVoltaje();
        obtenerAmperaje();
        obtenerTemperatura();
    }
}
